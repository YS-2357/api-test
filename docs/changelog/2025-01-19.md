# 개발 진행 로그

## 사용 방법
- 모든 중요한 의사결정, 마일스톤 도달, 리스크 발생/완화 내역을 날짜순으로 기록합니다.
- 각 항목은 **날짜 / 상태 요약 / 결정 사항 / 다음 단계** 블록으로 구성하며, 관련 PR·이슈·문서 경로를 괄호로 남깁니다.
- 분기별 리뷰 시 이 로그를 기반으로 `docs/changelog/`와 릴리스 노트를 업데이트합니다.

---

### 2025-11-19 — 서비스 출시 목표 확정
- **상태 요약**: 2025년 내 상용 출시 목표 설정, 아키텍처/인증/플랜 관리 요구사항 확정
- **결정 사항**
  - FastAPI·LangGraph·Streamlit을 분리하여 운영 가능하도록 재구성
  - 인증/사용량/히스토리/플랜 확장 요구사항을 충족시키는 DB 스키마와 파일 구조 정의
  - `docs/development/roadmap-2025.md`에 연간 로드맵을 수립하고, 이후 진행 상황은 본 로그에 적재
- **다음 단계**
  1. Phase 1 (인증 및 DB 기초) 작업을 이슈화하고 우선순위 정렬
  2. FastAPI 엔드포인트 리팩터링 및 LangGraph 비동기화를 위한 기술 검토 문서 작성
  3. Streamlit 인증 UX 초안 제작 및 사용자 흐름 다이어그램 추가

---

## 2025-11-19 (1차 코드 정리)

- **상태 요약**: 로드맵에 맞춰 코드 구조를 패키지화하고 실행 플로우를 단순화
- **변경 내역**
  1. `app/` 패키지 생성: `config.py`, `main.py`, `api/routes.py`, `services/langgraph.py`, `ui/streamlit_app.py`로 역할 분리 및 `__init__.py` 구성
  2. `scripts/run_app.py` 도입: FastAPI + Streamlit 동시 실행 스크립트를 `app.config.Settings` 기반 설정으로 재작성하고 루트 `main.py`는 래퍼로 단순화
  3. `.fastapi_url` 관리를 프로젝트 루트로 이동하고 Streamlit이 동일 파일을 참조하도록 수정, 포트 자동 스캔 대신 환경변수 기반 고정 포트 사용으로 실행 경로 단순화
  4. `app/services/langgraph.py`를 스트리밍 전용 구조로 개편해 LLM 노드 완료 즉시 partial 이벤트를 발행하고, FastAPI `/api/ask`는 `StreamingResponse`로 뉴라인 구분 JSON을 반환하도록 변경
  5. Streamlit UI가 스트리밍 응답을 수신하면서 모델별 진행 상황을 즉시 갱신하도록 요청 처리 흐름과 상태 관리를 업데이트
  6. `README.md`에 스트리밍 응답 형식(부분/요약 이벤트)을 문서화하고 `docs/development/roadmap-2025.md`, `docs/development/progress-log.md` 추가
- **기대 효과**
  - 모듈별 책임이 명확해져 Phase 1~5 작업 시 충돌 최소화
  - 설정/실행/스트리밍 흐름이 일관되어 신규 기여자가 빠르게 환경을 구성 가능
  - 발전 과정 기록이 확보되어 향후 릴리스 노트 작성과 팀 커뮤니케이션 효율 향상

---

## 2025-11-20 — 스트리밍 개선 & 문서 보강

- **상태 요약**: 부분 응답 스트리밍이 안정화되었고 문서/코드 주석이 보강됨
- **변경 내역**
  1. LangGraph 노드가 `END`로 직접 연결되어 모델별 완료 이벤트가 즉시 FastAPI 스트림으로 전달되도록 재구성
  2. `/api/ask`가 `StreamingResponse`로 partial/summary 이벤트를 전송하고, Streamlit이 해당 스트림을 소비하며 모델별 진행 상황을 실시간으로 표시하도록 업데이트
  3. `app/config.py`, `app/main.py`, `app/api/routes.py`, `app/services/langgraph.py`, `app/ui/streamlit_app.py`, `scripts/run_app.py` 등 주요 파일에 Args/Returns를 포함한 docstring을 추가해 코드 가독성 향상
  4. 포트 스캐닝 로직 제거와 고정 포트 환경변수 사용 안내를 README에 반영
  5. 의존성(예: pydantic-settings) 제거 및 config를 dataclass 기반으로 단순화
- **다음 단계**
  1. Phase 1 DB/인증 스켈레톤 파일(`database.py`, `models.py`, `auth.py`, `schemas.py`) 추가
  2. LangGraph 비동기 실행 + SSE/WebSocket 등 보다 정교한 스트리밍 방식 검토
  3. 테스트 및 모니터링 기준 수립 (간단한 e2e 호출 스크립트 포함)

---

## 2025-11-20 — 미사용 진입점 정리

- **상태 요약**: FastAPI 경로가 스트리밍 흐름을 전담하면서 남아 있던 레거시 헬퍼를 제거해 코드 일관성을 확보
- **변경 내역**
  1. `app/services/langgraph.py`에서 `_aggregate_stream()`과 `run_graph()`를 삭제하고 스트리밍 API만 남김
  2. `app/services/__init__.py`의 `run_graph` export 제거로 잘못된 사용 가능성을 차단
- **다음 단계**
  1. Tavily 통합 시 필요한 경우 새 노드/상태 필드를 추가
  2. Async/Send API 전환 계획에 맞춰 LangGraph 모듈 리팩터링 착수

---

## 2025-11-21 — LangGraph 비동기/병렬 전환

- **상태 요약**: LLM 노드 호출과 FastAPI 스트리밍 루프를 전면적으로 비동기화해 모델 병렬 실행 기반을 마련
- **변경 내역**
  1. LangGraph 노드(`call_*`)를 `async def`로 전환하고 모든 LLM 호출에 `ainvoke` 우선, 미지원 모델은 executor로 감싸 비동기로 강제
  2. Send API 전용 `dispatch_llm_calls`를 도입해 `init_question`에서 5개 LLM 노드로 동시에 fan-out 하도록 구성
  3. `stream_graph`를 `app.astream` 기반 `async` 제너레이터로 바꿔 LangGraph 이벤트를 자연스럽게 비동기 스트림으로 노출
  4. `/api/ask` 라우터가 비동기 제너레이터로 이벤트를 송출하도록 업데이트하여 FastAPI가 asyncio 루프에서 바로 스트리밍하도록 개선
  5. FastAPI summary 응답에 모델 완료 순서/최초 완료 모델 정보를 추가하고 Streamlit UI가 이를 시각화
  6. Streamlit 호출부를 `httpx.stream()` 기반으로 교체해 HTTP/2 지원과 세분화된 예외 처리를 확보
  7. LangGraph 스트림/FastAPI/Streamlit 전 구간에 오류 이벤트 수집·요약 로직을 추가해 일부 모델 실패 시에도 서비스가 중단되지 않도록 개선
  8. `app/logger.py`에서 이모지 로그 포맷터를 도입하고 주요 모듈/스크립트에 적용하여 실행 상황을 일관되게 추적
- **다음 단계**
  1. Streamlit 측에서도 비동기 HTTP 클라이언트 실험 후 필요 시 교체
